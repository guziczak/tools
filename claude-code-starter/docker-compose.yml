version: '3.8'
services:
  claude-code:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-code-container
    container_name: claude-code-container
    stdin_open: true
    tty: true
    volumes:
      # Montuj dyski - bubblewrap będzie kontrolował dostęp
      - /c:/c
      - /d:/d
      - /e:/e
      # Nie montujemy docker socket - bezpieczeństwo!
    working_dir: /workspace
    restart: unless-stopped
    command: sleep infinity  # Best practice zamiast tail -f /dev/null
    environment:
      - DOCKER_BUILDKIT=1
    # Minimalne capabilities
    cap_drop:
      - ALL  # Najpierw zabierz wszystko
    cap_add:
      - SYS_ADMIN  # Potrzebne dla bubblewrap mount namespace
      - SETUID     # Potrzebne dla bubblewrap user namespace
      - SETGID     # Potrzebne dla bubblewrap user namespace
    security_opt:
      - no-new-privileges:true  # Brak eskalacji uprawnień
      # apparmor i seccomp pozostają domyślne (confined)